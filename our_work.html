<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Through our God errands, PapaGod is using the Sholly Smile Factory to renew hopes and reconnect people to Christ">
  <!-- Facebook Meta Tags -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Learn About What We Do At The Shola Adefolalu Gaska Foundation">
  <meta property="og:description" content="Through our God errands, PapaGod is using the Sholly Smile Factory to renew hopes and reconnect people to Christ">
  <meta property="og:image" content="https://www.theshollysmilefactory.org/tssp/tssp1.jpg">
  <meta property="og:url" content="https://www.theshollysmilefactory.org/our_work">
  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="theshollysmilefactory.org">
  <meta property="twitter:url" content="https://www.theshollysmilefactory.org/our_work">
  <meta name="twitter:title" content="Learn About What We Do At The Shola Adefolalu Gaska Foundation">
  <meta name="twitter:description" content="Through our God errands, PapaGod is using the Sholly Smile Factory to renew hopes and reconnect people to Christ">
  <meta name="twitter:image" content="https://www.theshollysmilefactory.org/tssp/tssp1.jpg">
    <title>Learn About What We Do At The Shola Adefolalu Gaska Foundation</title>
    <link rel="icon" type="image/x-icon" href="logo.jpg">
    <style>
    /* General reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

    /* Hide both divs by default */
#mobile-header, #navDrawer, #desktop-header {
    display: none;
}

/* Show div with ID x for mobile devices */
@media (max-width: 767px) { /* Adjust the max-width as needed for your mobile breakpoint */
    #mobile-header, #navDrawer  {
        display: block; /* or inline-block, flex, etc., based on your layout needs */
    }
}

/* Show div with ID y for desktop devices */
@media (min-width: 768px) { /* Adjust the min-width as needed for your desktop breakpoint */
    #desktop-header {
        display: block; /* or inline-block, flex, etc., based on your layout needs */
    }
}

    @media only screen and (max-width: 768px) {
	/* Header styling */
        header {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 10px 0; /* Top and bottom padding */
            width: 100%; /* Ensures header takes full width */
            position: relative; /* Positioning context for the drawer */
        }

        .header-container {
            display: flex;
            align-items: center; /* Vertically centers items */
            justify-content: space-between; /* Space items to occupy full width */
            padding: 0 20px; /* Add horizontal padding */
        }

        .logo {
            flex: none; /* Prevent flex-grow, keeps logo size fixed */
        }

        .foundation-name {
            flex: 1; /* Allow foundation name to take available space */
            text-align: center; /* Center text within its space */
            margin: 0; /* Remove any default margins */
        }

        /* New styling for right-side container */
        .right-side {
            display: flex; /* Align donate button and menu icon in a column */
            flex-direction: column; /* Stack items vertically */
            align-items: flex-end; /* Align items to the right */
        }

        .menu-icon {
            flex: none; /* Prevent flex-grow, keeps menu icon size fixed */
            cursor: pointer; 
            font-size: 24px; /* Adjust font size as needed */
            margin-top: 10px; /* Space between donate button and menu icon */
        }

        /* Logo styling */
        .logo img {
            height: 50px;
            max-width: 100%; /* Adjust logo size for smaller screens */
        }

        /* Foundation name styling */
        .foundation-name h1 {
            font-size: 4vw; /* Responsive font size */
            margin: 0;
        }
        
        /* Donate button styling */
        .donate-button a {
            background-color: #FFCC00; /* Example yellow color for the button */
            color: #333;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            text-align: center; /* Center text in the button */
        }

        .donate-button a:hover {
            background-color: #FFD633;
        }

        
        .drawer-donate-button {
            margin-top: auto;
            margin-bottom: 50px;
            text-align: center;
            padding: 16px;
            background-color: #FFCC00;
            color: white;
            border-radius: 4px;
        }

        .drawer-donate-button a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        
        .drawer-donate-button a:hover {
            background-color: #FFD633;
        }

        
        
        
        /* Navigation drawer styling */
        .drawer {
            position: fixed;
            top: 0;
            left: 0;
            width: 80%;
            max-width: 300px;
            height: 100%;
            background-color: #ffffff;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 16px;
            overflow-y: auto;
            border-top-right-radius: 8px; /* Rounded corner for Material Design */
            border-bottom-right-radius: 8px;
        }

        .drawer.open {
            transform: translateX(0);
        }

        

        .nav-item {
            font-size: 18px;
            padding: 12px 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
            color: #FFD633;
            transition: background-color 0.2s;
        }

        .nav-item:hover {
            background-color: #f5f5f5;
        }
        .nav-item a {
    text-decoration: none; /* Remove underline */
    color: black;
}

        .sub-menu {
            display: none;
            padding-left: 16px;
        }

        .sub-menu.open {
            display: block;
        }

        .sub-menu div {
            padding: 8px 0;
        }

        .sub-menu a {
            text-decoration: none;
            color: #FFD633;
            font-size: 16px;
        }

        .sub-menu a:hover {
            text-decoration: underline;
        }

        .arrow {
            font-size: 30px;
        }


        /* Close icon in the drawer */
        .close-icon {
            cursor: pointer;
            font-size: 24px;
            margin-bottom: 20px; /* Space below the close icon */
        }
        
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
           text-align: center;
        }
        .errand-card {
        	display: flex;

            flex-direction: column;
            justify-content: center;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 16px;
        }
        .card-content {
            display: flex;
            flex-direction: column;
        }
        .left-column, .right-column {
            width: 100%;
        }
        .errand-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .errand-description {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        .errand-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 12px;
        }
        .arrow-container {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        .arrow {
            cursor: pointer;
            font-size: 24px;
            margin: 0 10px;
        }
        .completed-tasks {
            text-align: center;
            font-weight: 600;
            color: #FFD700;
            margin-top: 12px;
        }
        
        
      
        footer {
            text-align: center;
            padding: 10px;
        }   
        
  } 
  
  @media only screen and (min-width: 769px) {
        /* Basic styling for layout */
        /* Header styling */
header {
  background-color: white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  padding: 10px 20px;
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 1200px;
  margin: auto;
}

/* Logo styling */
.logo img {
  height: 50px;
}

/* Navigation styling */
.nav-links {
  list-style: none;
  display: flex;
  gap: 30px;
}

.nav-links a {
  color: #333;
  text-decoration: none;
  font-weight: 500;
  position: relative;
}

/* Default hide for all dropdown menus */
.dropdown-menu {
  display: none;
  position: absolute;
  background-color: white;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  padding: 10px;
  list-style: none;
  min-width: 300px;
  z-index: 10;
}

/* Show dropdown on hover */
.dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown:hover .resources {
  display: flex; /* Only apply flex layout on hover */
  gap: 20px;
}

.dropdown-menu a {
  display: block;
  padding: 8px 15px;
  white-space: nowrap;
  color: #333;
}

.dropdown-menu a:hover {
  background-color: #f0f0f0;
}


/* Flex layout for individual columns */
.dropdown-column {
  display: flex;
  flex-direction: column; /* Stacks items vertically within each column */
  gap: 8px;
}

/* Heading and link styles */
.resources h4 {
  font-size: 14px;
  margin-bottom: 8px;
  color: #666;
}

.resources a {
  color: #333;
  text-decoration: none;
}

.resources a:hover {
  background-color: #f0f0f0;
}

/* Donate button styling */
.donate-button a {
  background-color: #FFCC00; /* Example yellow color for the button */
  color: #333;
  padding: 10px 20px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: bold;
}

.donate-button a:hover {
  background-color: #FFD633;
}

.section {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .errand-card {
            display: flex;
            flex-direction: column;
            width: 800px; /* Adjust width as needed */
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto; /* Center card on the page */
        }

        .card-content {
            display: flex;
            flex-grow: 1;
            padding: 16px;
        }

        .left-column {
            flex: 1;
            margin-right: 10px; 
        }

        .right-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center; 
        }

        .errand-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .errand-description {
            font-size: 1em;
            margin-bottom: 16px;
        }
        
        .errand-image {
    width: 100%;
    height: 400px;
    object-fit: contain;
    object-position: center; /* Center the image */
    border-radius: 4px;
    cursor: pointer;
    background-color: #f5f5f5; /* Neutral background for letterboxing */
    padding: 5px; /* Small padding around image */
    box-sizing: border-box;
}
        
        .arrow-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        .arrow {
            cursor: pointer;
            font-size: 2em;
            margin: 0 10px;
        }
        
        
    footer {
            text-align: center;
            padding: 10px;
        }   
        
  

        
        .completed-tasks {
            text-align: center;
            font-weight: bold;
            padding: 10px 0; 
        }
            
        .close-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            z-index: 1001;
        }
        
        .expanded-image {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            max-width: 90%;
            max-height: 90%;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

  } 

/* Testimonials Section */
#testimonials {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.testimonial-category {
    text-align: center; /* Center-align everything within each testimonial category */
    margin-bottom: 40px; /* Add some spacing below each category */
}

.testimonial-category h3 {
    font-size: 1.5em; /* Adjust the font size as needed */
    font-weight: bold;
    margin-top: 20px;
    margin-bottom: 20px; /* Space between the title and the testimonials */
    color: #333; /* Color for the titles */
}


.testimonial-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
}

.testimonial-card {
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 20px;
    width: 300px;
    height: auto;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
    cursor: pointer;
    margin-bottom: 30px;
}

.testimonial-card:hover {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .testimonial-card {
        width: 100%; /* Full width on small screens */
    }
}
 
.page-header {
  background-color: #FFD700; /* Shade of yellow */
  color: white;
  text-align: center;
  padding: 20px 0;
  font-size: 1.2rem;
}

/* Text Switcher Styles */
.text-switcher-container {
    position: relative;
    min-height: 200px;
}

.text-content {
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 12px;
    transition: opacity 0.5s ease;
}

.text-controls {
    display: flex;
    justify-content: center;
    width: 100%;
    margin-top: 10px;
    position: static; 
}

.text-control-btn {
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    color: #333;
}

.text-control-btn:hover,
.left-arrow:hover,
.right-arrow:hover {
    color: #FFD633;
}

/* TTS Controls */
.tts-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    background-color: #f9f9f9;
    border-bottom: 1px solid #e0e0e0;
    gap: 10px;
}

.tts-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    background-color: #FFCC00;
    padding: 10px 15px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.tts-toggle:hover {
    background-color: #FFD633;
    transform: translateY(-2px);
}

.tts-toggle.active {
    background-color: #4CAF50;
    color: white;
}

.tts-toggle.active:hover {
    background-color: #45a049;
}

.tts-label {
    font-weight: bold;
    font-size: 16px;
}

.tts-icon {
    width: 24px;
    height: 24px;
}

.tts-status {
    font-size: 14px;
    color: #666;
    font-style: italic;
}

/* Focus styles for cards */
.errand-card:focus {
    outline: 3px solid #FFCC00;
    outline-offset: 2px;
}

.errand-card.active {
    box-shadow: 0 0 0 3px #FFCC00;
}

    </style>
</head>
<body>
<header id="desktop-header">
    <div class="header-container">
      <!-- Left side: Logo -->
      <div class="logo">
        <a href="index.html">
    <img src="logo.jpg" alt="Foundation Logo" />
</a>
      </div>

      <!-- Center: Navigation Links -->
      <nav>
        <ul class="nav-links">
          <li class="dropdown">
            <a href="about.html">ABOUT US</a>
            <ul class="dropdown-menu">
              <li><a href="about.html#mission">Our Mission</a></li>
              <li><a href="about.html#why">Our Why</a></li>
              <li><a href="about.html#team">Our Team</a></li>
              <li><a href="about.html#board">Board of Trustees</a></li>
              <li><a href="about.html#financials">Financials</a></li>
              <li><a href="about.html#awards">Awards</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="our_work.html">WHAT WE DO</a>
            <ul class="dropdown-menu">
              <li><a href="our_work.html#god_errands">Our God Errands</a></li>
              <li><a href="our_work.html#testimonials">Our Testimonials</a></li>
            </ul>
          </li>
          <li class="dropdown">
  <a href="media.html">RESOURCES AND MEDIA</a>
  <ul class="dropdown-menu resources">
    <div class="dropdown-column">
      <h4>NEWS & STORIES</h4>
      <a href="media.html#stories">Our Stories</a>
      <a href="media.html#projects">Project Spotlights</a>
      <a href="media.html#media">TSAG in the News</a>
    </div>
    <div class="dropdown-column">
      <h4>MULTIMEDIA</h4>
      <a href="media.html#photos">Photographs</a>
      <a href="media.html#video-section">Videos</a>
    </div>
    <div class="dropdown-column">
      <h4>RESOURCES</h4>
      <a href="media.html#books">Books</a>
      <a href="media.html#podcasts">Podcasts</a>
    </div>
  </ul>
</li>
        </ul>
      </nav>

      <!-- Right side: Donate Button -->
      <div class="donate-button">
        <a href="donate.html">Donate</a>
      </div>
    </div>
  </header>
<header id="mobile-header">
    <div class="header-container">
        <!-- Left side: Logo -->
        <div class="logo">
        <a href="index.html">
            <img src="logo.jpg" alt="Foundation Logo" />
            </a>
        </div>

        <!-- Center: Foundation Name -->
        <div class="foundation-name">
            <h1>The Shola Adefolalu Gaska Foundation</h1>
        </div>

        <!-- Right side: Container for Donate Button and Menu Icon -->
        <div class="right-side">
            <div class="donate-button">
                <a href="donate.html">Donate</a>
            </div>
            <div class="menu-icon" onclick="toggleDrawer()">&#9776;</div>
        </div>
    </div>
</header>

<!-- Navigation Drawer -->
<div class="drawer" id="navDrawer">
    <div class="close-icon" onclick="toggleDrawer()">&times;</div> <!-- Close icon -->
    <div class="nav-item">
        <a href="about.html"><span>ABOUT US</span></a>
        <span class="arrow" onclick="toggleSubMenu('aboutSubMenu')">&#9662;</span>
    </div>
    <div class="sub-menu" id="aboutSubMenu">
        <div><a href="about.html#mission">Our Mission</a></div>
        <div><a href="about.html#why">Our Why</a></div>
        <div><a href="about.html#team">Our Team</a></div>
        <div><a href="about.html#board">Board of Trustees</a></div>
        <div><a href="about.html#financials">Financials</a></div>
        <div><a href="about.html#awards">Awards</a></div>
    </div>
    
    <div class="nav-item">
        <a href="our_work.html"><span>WHAT WE DO</span></a>
        <span class="arrow" onclick="toggleSubMenu('whatWeDoSubMenu')">&#9662;</span>
    </div>
    <div class="sub-menu" id="whatWeDoSubMenu">
        <div><a href="our_work.html#god_errands">Our God Errands</a></div>
        <div><a href="our_work.html#testimonials">Our Testimonials</a></div>
    </div>
    
    <div class="nav-item">
        <a href="media.html"><span>RESOURCES AND MEDIA</span></a>
        <span class="arrow" onclick="toggleSubMenu('resourcesSubMenu')">&#9662;</span>
    </div>
    <div class="sub-menu" id="resourcesSubMenu">
        <div><a href="media.html#stories">Our Stories</a></div>
        <div><a href="media.html#projects">Project Spotlights</a></div>
        <div><a href="media.html#media">TSAG in the News</a></div>
        <div><a href="media.html#photos">Photographs</a></div>
        <div><a href="media.html#video-section">Videos</a></div>
        <div><a href="media.html#books">Books</a></div>
        <div><a href="media.html#podcasts">Podcasts</a></div>
    </div>

    <div class="drawer-donate-button" style="margin-top: auto;">
        <a href="donate.html">Donate</a>
    </div>
</div>

<!-- TTS Controls at the top -->
<div class="tts-controls">
    <div class="tts-toggle" id="tts-toggle">
        <svg class="tts-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
        <span class="tts-label" id="tts-label">Turn On Audio</span>
    </div>
    <div class="tts-status" id="tts-status">Audio is off</div>
</div>

<header class="page-header">
  <h2>WHAT WE DO</h2>
  </header>
    <!-- What We Do Section -->
    <section class="section" id="god-errands">
        <div class="section-title">OUR GOD ERRANDS</div>
        
        <!-- Errand Cards will be populated by JavaScript -->
        <div id="errands-container"></div>
    </section>
    <section id="testimonials">
    <h2>Our TSSP Testimonials  (2021 to date)</h2>
    
    <!-- Residents Section -->
    <div class="testimonial-category">
        <h3>Residents</h3>
        <div class="testimonial-container" id="residents-testimonials">
            <!-- Resident testimonials will be inserted here by JavaScript -->
        </div>
    </div>
    
    <!-- Team Members Section -->
    <div class="testimonial-category">
        <h3>TSSP Team Members</h3>
        <div class="testimonial-container" id="team-testimonials">
            <!-- Team member testimonials will be inserted here by JavaScript -->
        </div>
    </div>
    
    <!-- Volunteers Section -->
    <div class="testimonial-category">
        <h3>Volunteers</h3>
        <div class="testimonial-container" id="volunteer-testimonials">
            <!-- Volunteer testimonials will be inserted here by JavaScript -->
        </div>
    </div>
</section>
<footer>
        <p>&copy; 2025 The Shola Adefolalu Gaska Foundation. All rights reserved.</p>
    </footer>
  <script>
    // Errand data structure (UNTOUCHED)
    const errandsData = [
        {
            id: "food",
            title: "Fighting Food Poverty",
            description: "Since September 2020, we have been giving out Sholly COVID-19 Care packages to vulnerable families in need every month. In each package, each family gets bags of rice, beans, garri and vegetable oil.",
            images: [
                "care_packages/may_2022.jpg", 
                "care_packages/june_2022.jpg", 
                "care_packages/dec_2022.jpg", 
                "care_packages/special_dec_2022.jpg", 
                "care_packages/jan_2023.jpg", 
                "care_packages/feb_2023.jpg", 
                "care_packages/feb_2023_abuja.jpg",
                "care_packages/april_2023.jpg", 
                "care_packages/jan_2024.jpg", 
                "care_packages/feb_2024.jpg", 
                "care_packages/march_2024.jpg", 
                "care_packages/april_2024.jpg", 
                "care_packages/may_2024.jpg", 
                "care_packages/june_2024.jpg", 
                "care_packages/july_2024.jpg", 
                "care_packages/aug_2024.jpg"
            ],
            completedTasks: "400+ food packages distributed till date"
        },
        {
            id: "tssp",
            title: "Providing a Safe Haven for Domestic Abuse Survivors",
            description: "On June 12, 2021, The Foundation opened the doors to its Shelter: The Sholly Serenity Place aka Sholly's Safe Home. It is a ten-bed Jesus Christ-Centric Safe Haven and an Oasis of Serenity for survivors of domestic abuse and their children. \n\nOur WHY is to provide safe, temporary accommodation for our residents while they receive counselling and legal advice from Lagos State's Domestic and Sexual Violence Agency (DSVA) or the NGO/ Church handling their cases.Â  \n\nWe believe that knowing that she will have a safe place to lay her head will facilitate a quicker and smoother transition from despair to hope as she works with her Counsellor and/or Lawyer. This will, in turn, hasten her readiness to take the needed next steps towards her future. \n\nGuests referred to us are accommodated, fed and cared for totally free of cost. \n\nOur core values are Care, Compassion, Honesty and Respect for People.",
            images: ["tssp/tssp1.jpg", "tssp/tssp2.jpg", "tssp/tssp3.jpg", "tssp/tssp4.jpg", "tssp/tssp5.jpg", "tssp/tssp6.jpg", "tssp/tssp7.jpg", "tssp/tssp8.jpg", "tssp/tssp9.jpg", "tssp/tssp10.jpg", "tssp/tssp11.jpg", "tssp/tssp12.jpg"],
            completedTasks: "41 women and children accommodated till date"
        },
        {
            id: "alive",
            title: "Empowering Financially Vulnerable Women",
            description: "In May 2024, to honor the memories of loved ones gone, we launched the Adefolalu Love is A Verb (ALiVe) initiative. \n\nThis social safety-net provides a 25,000 naira monthly allowance to extremely economically vulnerable women from across twelve states in Nigeria.Â  \n\nOur hope is to have reached families across Nigeria come Q4 2026 or sooner.",
            images: ["alive.png"],
            completedTasks: "Women across 12 states empowered till date"
        },
        {
            id: "masterclass",
            title: "#PayWhatYouCan Masterclass Academy",
            description: "The #PayWhatYouCan Masterclass Academy is an empowering learning and fundraising initiative by The Shola Adefolalu Gaska Foundation (TSAGF) â€” also known as The Sholly Smile Factory.",
            images: ["masterclass1.jpg", "masterclass2.jpg", "masterclass3.jpg"],
            completedTasks: "Pilot program launching November 2025",
            hasTextSwitcher: true,
            texts: [
                "The #PayWhatYouCan Masterclass Academy is an empowering learning and fundraising initiative by The Shola Adefolalu Gaska Foundation (TSAGF) â€” also known as The Sholly Smile Factory.",
                "Our goal is simple yet profound: To make personal growth and transformation accessible to all â€” while raising vital support for women and children rebuilding their lives at The Sholly Serenity Place (TSSP), our safe haven for survivors of domestic abuse.",
                "Every quarter in 2026, we plan to host expert-led online masterclasses across areas like finance, leadership, communication, service, wellness, and purpose. Participants 'pay what you can' â€” and every naira raised goes directly toward the operations of TSSP.",
                "It's a win-win: You learn. You grow. You help others heal.",
                "The Pilot: A 5-Week #PayWhatYouCan Masterclass Series (Novemberâ€“December 2025) with the theme: Start Your 2026 Strong",
                "Why Register? Because growth should not be gated by money â€” and generosity creates ripple effects. When you register, you gain access to world-class experts, acquire tools to elevate your life, and help survivors of domestic violence rebuild their futures.",
                "What Makes This Different: Inclusive Giving, Transformational Content, Purpose-Driven Impact, and Legacy of Love. 100% of proceeds go toward supporting survivors at TSSP.",
                "Together, We Grow and Give. The #PayWhatYouCan Masterclass Academy is more than a learning platform â€” it's a movement for hope, empowerment, and impact."
            ]
        }
    ];

    // Current image index tracker for each errand (UNTOUCHED)
    const currentImageIndex = {};

    // Detect if device is mobile (UNTOUCHED)
    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
               (window.innerWidth <= 768);
    }

    // Function to render all errand cards (UNTOUCHED)
    function renderErrandCards() {
        const container = document.getElementById('errands-container');
        
        errandsData.forEach(errand => {
            currentImageIndex[errand.id] = 0;
            
            const card = document.createElement('div');
            card.className = 'errand-card';
            card.id = errand.id;
            card.tabIndex = 0;
            
            let leftColumnContent = '';
            if (errand.hasTextSwitcher) {
                const isMobile = isMobileDevice();
                const pauseButtonStyle = isMobile ? 'display:none;' : '';
                const playButtonStyle = isMobile ? 'display:inline-block;' : 'display:none;';
                
                leftColumnContent = `
                    <div class="errand-title">${errand.title}</div>
                    <div class="text-switcher-container">
                        <div class="text-content" id="${errand.id}-text">
                            ${errand.description}
                        </div>
                        <div class="text-controls">
                            <button id="${errand.id}-pause-btn" class="text-control-btn" title="Pause Text Switching" style="${pauseButtonStyle}">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <rect x="6" y="4" width="4" height="16"></rect>
                                    <rect x="14" y="4" width="4" height="16"></rect>
                                </svg>
                            </button>
                            <button id="${errand.id}-play-btn" class="text-control-btn" style="${playButtonStyle}" title="Play Text Switching">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <polygon points="5,3 19,12 5,21"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                leftColumnContent = `
                    <div class="errand-title">${errand.title}</div>
                    <p class="errand-description">${errand.description.replace(/\n/g, '<br>')}</p>
                `;
            }
            
            card.innerHTML = `
                <div class="card-content">
                    <div class="left-column">
                        ${leftColumnContent}
                    </div>
                    <div class="right-column">
                        <img src="${errand.images[0]}" alt="${errand.title} Image" class="errand-image" id="${errand.id}-image">
                        <div class="arrow-container">
                            <span class="arrow left-arrow" onclick="switchImage('${errand.id}', -1)">&#9664;</span>
                            <span class="arrow right-arrow" onclick="switchImage('${errand.id}', 1)">&#9654;</span>
                        </div>
                    </div>
                </div>
                <div class="completed-tasks">${errand.completedTasks}</div>
            `;
            
            container.appendChild(card);
            
            if (errand.images.length <= 1) {
                const arrows = card.querySelectorAll('.arrow');
                arrows.forEach(arrow => arrow.style.display = 'none');
            }
            
            const image = card.querySelector('.errand-image');
            image.addEventListener('click', () => enlargeImage(image.src));
        });
    }

    function toggleDrawer() {
        const drawer = document.getElementById('navDrawer');
        const isOpen = drawer.classList.toggle('open');

        if (isOpen) {
            const subMenus = document.querySelectorAll('.sub-menu');
            subMenus.forEach((subMenu) => {
                subMenu.classList.remove('open');
            });
        }
    }

    function toggleSubMenu(menuId) {
        const subMenu = document.getElementById(menuId);
        subMenu.classList.toggle('open');
    }
    
    // Function to switch images (UNTOUCHED)
    function switchImage(errandId, direction) {
        const errand = errandsData.find(e => e.id === errandId);
        if (!errand) return;
        
        const images = errand.images;
        currentImageIndex[errandId] += direction;

        if (currentImageIndex[errandId] < 0) {
            currentImageIndex[errandId] = images.length - 1;
        } else if (currentImageIndex[errandId] >= images.length) {
            currentImageIndex[errandId] = 0;
        }

        document.getElementById(`${errandId}-image`).src = images[currentImageIndex[errandId]];
    }

    // Function to enlarge the image on click (UNTOUCHED)
    function enlargeImage(imageSrc) {
        const overlay = document.createElement('div');
        overlay.classList.add('overlay');

        const img = document.createElement('img');
        img.src = imageSrc;
        img.classList.add('expanded-image');
        
        const closeIcon = document.createElement('span');
        closeIcon.className = 'close-icon';
        closeIcon.innerHTML = '&times;'; 
        closeIcon.onclick = () => {
            document.body.removeChild(overlay);
        };

        overlay.appendChild(img);
        overlay.appendChild(closeIcon); 
        document.body.appendChild(overlay);
    }
    
// Testimonial data (UNTOUCHED)
const residentTestimonials = [
    "I am so thankful to Grandma for accommodating me and my children. My lifestyle in general has changed, I have become free and social, meeting people and making friends. I remember, at first being scared as I did not know I will meet, so I prayed about the whole thing, also I was sick for a while but God used Grandma to perfect my health. I am grateful for the hospitality, corrections with love and kind gestures, in her words...I remember how chaotic my life was. Not being certain about what life had in store for me, but since I have been here, I feel at peace. I now pray with certainty and assurance that my prayers answered.",
    "I thank God for making me to know TSSP (The Sholly Serenity Place) when I have been having a heavy burden and marital emotional distress in my marriage over 4 - 5 years which the journey looks like hell with prayers and fasting till it seems hope is gone. My marriage has been toxic and a friend introduced me to TSSPâ€¦. TSSP brings smiles and laughter to myself and childrenâ€¦. The staff there are friendly, respectful, caring and accommodatingâ€¦",
"My prayer life has changed. My mind transformed. My experience taught me how to forgive. I also learnt how to put God first in everything I doâ€¦. even my children are behaving better nowâ€¦.",
    "I\'m happy here because since I come here, the love here, I've never experienced it before. I don't even know how to appreciate God for many things He has done in my life. I've come to know God better than before. I pray now unlike before when I didn't even used to pray. Small, small I am now reading the bible that I've never ever read before. Because one of my eyes got bad it affected my reading, so I never bothered to read anything talk less of the Bible. But when I came here, we have morning devotion and everybody will read Bible and they treated me like they didn't care that one of my eyes is bad...it really encouraged me to start reading my Bible, especially since the Bible was given to me free when I came here. I really, really thank God for all He has done",
    "My life has truly changed since I arrived, I feel God's presence when I came to Sholly Serenity place and it drew me closer to God. My prayer life and Bible study changed, I learnt to be more disciplined and tolerate people."
];

const teamMemberTestimonials = [
    "Working here has been nothing short of a uniquely divine experience. At the risk of sounding spiritual, one of my hearts desires has been to work in a place that unashamedly honors God and seeks after Godly things and honestly that's what TSSP is all about. Not to say we don't have our struggles or issues, after all Jesus's disciples had issues, yet on a daily basis we make tangible contact with the faithfulness of God who has not once forsaken us since I started working here. What more could I ask for?",
    "Working with Sholly's place is excellent. It is the center of God's presence. I work for the first time of my life with people of love, care and full of His Spirit. We work together as a family and it makes my work easy and for this, I am very grateful.",
    "God's presence through worship music being played round the house. The ambience is top notch. The atmosphere is very peaceful. My work experience has taught me serve and not to think about myself alone. My experience has drawn me closer to God"
];

const volunteerTestimonials = [
    "The first thing that struck me when I stepped into the Sholly Serenity Place was the ambiance, there was this sense of 'welcome home'. There was sense of hope and peace and everywhere was just calm",
    "TSSP is a safe haven. More like a home on the journey to home. I see ladies come in broken and with so much palpable fear and timidity. And within a few days or weeks, they come alive and are transformed into someone filled with so much hope that they express as confidence and improved self-esteem. I see God's redemptive act in action in their lives, and it is a privilege to be part of this team, to the glory of God.",
    "I come to Sholly's home and it feels like family for me, it's beyond just volunteering for me, it's how we pray together and share beautiful moments and milestones together without anyone feeling left out.... It's how we are one in Unity and in Love. I love volunteering here and I will choose to do this Over and Over again...."
];

function renderTestimonials(containerId, testimonials) {
    const container = document.getElementById(containerId);
    
    testimonials.forEach(text => {
        const testimonialCard = document.createElement('div');
        testimonialCard.className = 'testimonial-card';
        testimonialCard.innerHTML = `<p>${text}</p>`;
        
        container.appendChild(testimonialCard);
    });
}

// Text switching functionality for the Masterclass Academy card (UNTOUCHED)
const textSwitchIntervals = {};
const currentTextIndexes = {};
const isTextSwitchingPaused = {};
let isMasterclassActive = false; 

// NEW: Track which cards have completed their first TTS read (Title + First Text + Tasks)
const hasCardBeenInitiallyRead = {};

// NEW: Track cards that are currently being spoken to prevent duplicate TTS
const currentlySpeakingCards = {};


// TTS variables (MODIFIED: Removed tts, added selectedVoice)
let selectedVoice = null; 
let isTtsReady = false;
let isTtsEnabled = true; 
let isTtsSpeaking = false;
let currentCardSpeaking = null;
let intersectionObserver;
let hasPlayedWelcome = false; 
let isWelcomeMessagePlaying = false; 
let hasUserInteracted = false; 
let interactionListenerAdded = false; 
let isMobileInitialized = false; 

// Initialize text switching for cards that have it (MODIFIED: Removed auto-start for mobile)
function initTextSwitching() {
    errandsData.forEach(errand => {
        if (errand.hasTextSwitcher) {
            currentTextIndexes[errand.id] = 0;
            isTextSwitchingPaused[errand.id] = false;
            hasCardBeenInitiallyRead[errand.id] = false; 
            currentlySpeakingCards[errand.id] = false; 
            
            const textElement = document.getElementById(`${errand.id}-text`);
            if (textElement) {
                textElement.textContent = errand.texts[currentTextIndexes[errand.id]];
            }
            updateTextSwitchingButtons(errand.id);
            
            // ðŸ”¥ FINAL FIX: DO NOT start the text switching interval automatically on mobile. 
            // Mobile devices will rely purely on user button presses via switchTextManual.
        } else {
             hasCardBeenInitiallyRead[errand.id] = false; 
             currentlySpeakingCards[errand.id] = false;
        }
    });
}

// Update text switching buttons visual state (UNTOUCHED)
function updateTextSwitchingButtons(errandId) {
    const pauseBtn = document.getElementById(`${errandId}-pause-btn`);
    const playBtn = document.getElementById(`${errandId}-play-btn`);
    
    if (pauseBtn && playBtn) {
        if (isTextSwitchingPaused[errandId]) {
            pauseBtn.style.display = 'none';
            playBtn.style.display = 'inline-block';
        } else {
            if (isMobileDevice()) {
                pauseBtn.style.display = 'none';
                playBtn.style.display = 'inline-block';
            } else {
                pauseBtn.style.display = 'inline-block';
                playBtn.style.display = 'none';
            }
        }
    }
}

// Start text switching interval for a specific errand (MODIFIED - Removed mobile check)
function startTextSwitching(errandId) {
    // Prevent starting if already running or if paused
    if (textSwitchIntervals[errandId] !== undefined || isTextSwitchingPaused[errandId]) {
        return;
    }
    
    // Only starts if initiated by desktop TTS onend event (via startTextSwitchingDesktop)
    textSwitchIntervals[errandId] = setInterval(() => switchText(errandId), 5000);
    console.log(`Text switching interval started for ${errandId}`);
}

// Start text switching on Desktop (Only called by TTS onend event or Play button) (UNTOUCHED)
function startTextSwitchingDesktop(errandId) {
    if (textSwitchIntervals[errandId] !== undefined || isTextSwitchingPaused[errandId]) {
        return;
    }
    textSwitchIntervals[errandId] = setInterval(() => switchText(errandId), 5000);
    console.log(`Desktop-specific text switching interval started for ${errandId}`);
}


// Switch to next text for a specific errand (UNTOUCHED)
function switchText(errandId) {
    const errand = errandsData.find(e => e.id === errandId);
    if (!errand || !errand.hasTextSwitcher) return;
    
    if (isTtsSpeaking && isTtsEnabled && currentCardSpeaking === errandId) {
        console.log('Skipping switch - currently speaking with TTS (switch will occur onend)');
        return;
    }
    
    currentTextIndexes[errandId] = (currentTextIndexes[errandId] + 1) % errand.texts.length;
    const textElement = document.getElementById(`${errandId}-text`);
    
    if (textElement) {
        textElement.style.opacity = 0;
        
        setTimeout(() => {
            textElement.textContent = errand.texts[currentTextIndexes[errandId]];
            textElement.style.opacity = 1;
            
            console.log('Switched to text:', currentTextIndexes[errandId]);
            
            if (isTtsEnabled && !isTextSwitchingPaused[errandId] && isCardActive(errandId)) {
                
                let isLastText = currentTextIndexes[errandId] === errand.texts.length - 1;
                
                console.log(`Auto-speaking new text. Is last text: ${isLastText}`);
                
                const updatedContent = getCardContent(errandId, false, isLastText);
                speakText(updatedContent, errandId); 
            }
        }, 300);
    }
}

// Manual text switching for mobile (UNTOUCHED)
function switchTextManual(errandId) {
    const errand = errandsData.find(e => e.id === errandId);
    if (!errand || !errand.hasTextSwitcher) return;
    
    if (isTtsSpeaking && currentCardSpeaking === errandId) {
        console.log('Stopping current TTS for manual text switch');
        stopTTS();
    }
    
    currentTextIndexes[errandId] = (currentTextIndexes[errandId] + 1) % errand.texts.length;
    const textElement = document.getElementById(`${errandId}-text`);
    
    if (textElement) {
        textElement.style.opacity = 0;
        
        setTimeout(() => {
            textElement.textContent = errand.texts[currentTextIndexes[errandId]];
            textElement.style.opacity = 1;
            
            console.log('Manually switched to text:', currentTextIndexes[errandId]);
            
            if (isTtsEnabled && isCardActive(errandId) && !isWelcomeMessagePlaying) {
                
                let isLastText = currentTextIndexes[errandId] === errand.texts.length - 1;
                
                console.log(`Auto-speaking NEW text after manual switch. Is last text: ${isLastText}`);
                
                const updatedContent = getCardContent(errandId, false, isLastText);
                if (updatedContent) {
                    speakText(updatedContent, errandId);
                }
            }
        }, 300);
    }
}

// Pause text switching for a specific errand (UNTOUCHED)
function pauseTextSwitching(errandId) {
    isTextSwitchingPaused[errandId] = true;
    updateTextSwitchingButtons(errandId);
    clearInterval(textSwitchIntervals[errandId]);
    textSwitchIntervals[errandId] = undefined;
    stopTTS(); 
    console.log(`Text switching paused for ${errandId}`);
}

// Play/resume text switching for a specific errand (UNTOUCHED)
function playTextSwitching(errandId) {
    // NEW: On mobile, manually switch to next text instead of starting interval
    if (isMobileDevice()) {
        switchTextManual(errandId);
        return;
    }
    
    isTextSwitchingPaused[errandId] = false;
    updateTextSwitchingButtons(errandId);
    
    if (isCardActive(errandId) && textSwitchIntervals[errandId] === undefined) {
        startTextSwitchingDesktop(errandId); 
    }
    
    console.log(`Text switching resumed for ${errandId}`);
    
    if (isTtsEnabled && isCardActive(errandId) && !isWelcomeMessagePlaying) {
        const errand = errandsData.find(e => e.id === errandId);
        if (errand && errand.hasTextSwitcher) {
            console.log('Resuming TTS playback with current text');
            
            const isLastText = currentTextIndexes[errand.id] === errand.texts.length - 1;
            const updatedContent = getCardContent(errandId, false, isLastText);
            
            if (updatedContent) {
                speakText(updatedContent, errandId);
            }
        }
    }
}

// Check if a card is currently active (in view) (UNTOUCHED)
function isCardActive(cardId) {
    if (cardId === 'masterclass') {
        return isMasterclassActive || isMobileDevice(); 
    }
    return false; 
}

// Play welcome message on user interaction (UNTOUCHED - Uses new Utterance)
function playWelcomeMessage() {
    if (hasPlayedWelcome || !isTtsEnabled || isWelcomeMessagePlaying || !selectedVoice) return;
    
    const welcomeText = "Welcome to The Shola Adefolalu Gaska Foundation (TSAGF). In this page, you will be learning about what we do, that is, our God Errands.";
    
    console.log('Attempting to play welcome message...');
    
    if (isTtsReady) {
        window.speechSynthesis.cancel(); 
        
        const welcomeTts = new SpeechSynthesisUtterance(welcomeText);
        welcomeTts.voice = selectedVoice;
        welcomeTts.rate = 0.9;
        welcomeTts.pitch = 1;
        welcomeTts.volume = 1;
        
        hasPlayedWelcome = true;
        isWelcomeMessagePlaying = true;
        
        welcomeTts.onstart = function() {
            isTtsSpeaking = true;
            updateTTSButtonState();
            console.log('Welcome message started playing');
        };
        
        welcomeTts.onend = function() {
            isTtsSpeaking = false;
            isWelcomeMessagePlaying = false;
            updateTTSButtonState();
            console.log('Welcome message finished');
            
            if (!isMobileDevice()) {
                initIntersectionObserver();
                setTimeout(() => {
                    const visibleCard = findFirstVisibleCard();
                    if (visibleCard && isTtsEnabled) {
                        const isInitial = !hasCardBeenInitiallyRead[visibleCard.id] || !errandsData.find(e => e.id === visibleCard.id && e.hasTextSwitcher);
                        const content = getCardContent(visibleCard.id, isInitial, isInitial && (currentTextIndexes[visibleCard.id] === errandsData.find(e => e.id === visibleCard.id)?.texts.length - 1 || false));
                        if (content) {
                            console.log('Speaking content for initially visible card after welcome:', visibleCard.id);
                            speakText(content, visibleCard.id);
                            if (errandsData.find(e => e.id === visibleCard.id && e.hasTextSwitcher)) {
                                hasCardBeenInitiallyRead[visibleCard.id] = true;
                            }
                        }
                    }
                }, 100);
            } else {
                initMobileCardTouchListeners();
            }
        };
        
        welcomeTts.onerror = function(event) {
            isTtsSpeaking = false;
            isWelcomeMessagePlaying = false;
            hasPlayedWelcome = true; 
            updateTTSButtonState();
            console.error('Welcome message TTS error:', event.error);
            
            if (!isMobileDevice()) {
                initIntersectionObserver();
            } else {
                initMobileCardTouchListeners();
            }
        };
        
        window.speechSynthesis.speak(welcomeTts);
    } else {
        setTimeout(playWelcomeMessage, 500);
    }
}

// Handle card touch on mobile (FIXED: Only stop TTS when tapping a different card)
function handleCardTouch(cardId) {
    console.log(`DEBUG: handleCardTouch called with cardId: ${cardId}`);
    
    if (!isTtsEnabled || !hasPlayedWelcome || isWelcomeMessagePlaying) {
        console.log('Card touch blocked - welcome message playing or TTS disabled');
        return;
    }
    
    // FIXED: Only stop TTS if we're tapping a DIFFERENT card
    if (currentCardSpeaking && currentCardSpeaking !== cardId) {
        console.log(`Switching from card ${currentCardSpeaking} to card ${cardId}, stopping current TTS`);
        stopTTS();
    }
    
    // FIXED: If tapping the same card that's currently speaking, do nothing
    if (currentCardSpeaking === cardId && isTtsSpeaking) {
        console.log(`Card ${cardId} is already speaking, ignoring tap on same card`);
        return;
    }
    
    // FIXED: If card is marked as currently speaking but TTS isn't actually speaking, reset state
    if (currentlySpeakingCards[cardId] && !isTtsSpeaking) {
        currentlySpeakingCards[cardId] = false;
    }
    
    // FIXED: If card is already marked as speaking, don't start again
    if (currentlySpeakingCards[cardId]) {
        console.log(`Card ${cardId} is already being spoken, ignoring duplicate touch`);
        return;
    }

    const errand = errandsData.find(e => e.id === cardId);
    
    // --- CRITICAL FIX: STATIC CARD Logic (Errands 1, 2, 3) ---
    if (!errand || !errand.hasTextSwitcher) {
        
        if (hasCardBeenInitiallyRead[cardId]) {
            console.log(`Static card ${cardId} already read. Ignoring subsequent touch.`);
            currentlySpeakingCards[cardId] = false; 
            currentCardSpeaking = null;
            return; 
        }

        currentlySpeakingCards[cardId] = true;
        
        const cardElement = document.getElementById(cardId);
        const title = cardElement.querySelector('.errand-title')?.textContent || '';
        const description = errand.description.replace(/\n/g, ' '); 
        const tasks = cardElement.querySelector('.completed-tasks')?.textContent || '';
        
        const content = `${title}. ${description}. ${tasks}`; 

        if (content) {
            console.log(`Speaking content for touched static card: ${cardId} (First Read)`);
            speakText(content, cardId); 
            hasCardBeenInitiallyRead[cardId] = true;
        } else {
            currentlySpeakingCards[cardId] = false; 
        }
        
        return; 
    }

    // --- Logic for Text-Switcher Card (Masterclass - Card 4) ---
    console.log(`Card ${cardId} touched on mobile`);
    
    currentlySpeakingCards[cardId] = true;
    
    const isInitial = !hasCardBeenInitiallyRead[cardId];
    const isLastText = errand.hasTextSwitcher && currentTextIndexes[cardId] === errand.texts.length - 1;
    
    const content = getCardContent(cardId, isInitial, isLastText);
    
    if (content) {
        console.log(`Speaking content for touched text-switcher card: ${cardId}`);
        speakText(content, cardId); 
        if (errand.hasTextSwitcher) {
            hasCardBeenInitiallyRead[cardId] = true; 
        }
    } else {
        currentlySpeakingCards[cardId] = false;
    }
}

// Initialize mobile card touch listeners (UNTOUCHED)
function initMobileCardTouchListeners() {
    console.log('DEBUG: Initializing mobile card touch listeners');
    
    document.querySelectorAll('.errand-card').forEach(card => {
        if (!card.id) {
            console.warn('DEBUG: Card without ID found:', card);
            return;
        }
        
        console.log(`DEBUG: Setting up listeners for card: ${card.id}`);
        
        card.removeEventListener('touchstart', handleMobileCardTouch);
        card.removeEventListener('click', handleMobileCardClick);
        
        card.addEventListener('touchstart', handleMobileCardTouch, { passive: true });
        card.addEventListener('click', handleMobileCardClick);
    });
    console.log('Mobile card touch listeners initialized');
}

// Handle mobile card touch (UNTOUCHED)
function handleMobileCardTouch(event) {
    if (!isMobileDevice()) return;
    
    const card = event.currentTarget;
    const cardId = card.id;
    
    try {
        event.preventDefault();
    } catch (e) {
    }
    event.stopPropagation();
    event.stopImmediatePropagation();
    
    console.log(`Mobile touch on card: ${cardId}`);
    handleCardTouch(cardId);
}

// Handle mobile card click (UNTOUCHED)
function handleMobileCardClick(event) {
    if (!isMobileDevice()) return;
    
    const card = event.currentTarget;
    const cardId = card.id;
    
    try {
        event.preventDefault();
    } catch (e) {
    }
    event.stopPropagation();
    event.stopImmediatePropagation();
    
    console.log(`Mobile click on card: ${cardId}`);
    handleCardTouch(cardId);
}


// TTS Speak function (FINAL FIX: Creates a new Utterance every time)
function speakText(text, cardId) {
    if (!isTtsReady || !isTtsEnabled || !hasPlayedWelcome || isWelcomeMessagePlaying || !selectedVoice) {
        console.log('TTS blocked (conditions not met or voice not ready)');
        return;
    }
    
    // 1. Aggressively stop any currently running speech and reset state
    window.speechSynthesis.cancel(); 
    isTtsSpeaking = false;
    currentCardSpeaking = null;
    Object.keys(currentlySpeakingCards).forEach(id => currentlySpeakingCards[id] = false);

    // 2. CREATE A BRAND NEW UTTERANCE OBJECT FOR ISOLATION
    const newTts = new SpeechSynthesisUtterance(text);
    newTts.voice = selectedVoice;
    newTts.rate = 0.9;
    newTts.pitch = 1;
    newTts.volume = 1;

    // 3. Set the state for the new object's lifetime
    currentCardSpeaking = cardId;
    currentlySpeakingCards[cardId] = true;

    newTts.onstart = function() {
        isTtsSpeaking = true;
        updateTTSButtonState();
        console.log('TTS started speaking for:', cardId);
    };
    
    newTts.onend = function() {
        isTtsSpeaking = false;
        currentlySpeakingCards[cardId] = false;
        updateTTSButtonState();
        console.log('TTS finished speaking for:', cardId);
        
        const errand = errandsData.find(e => e.id === cardId);
        if (errand && errand.hasTextSwitcher && isTtsEnabled && !isTextSwitchingPaused[cardId] && isCardActive(cardId)) {
            
            if (errand.id === 'masterclass' && !isMobileDevice() && !hasCardBeenInitiallyRead[errand.id]) {
                 console.log('Masterclass initial TTS finished. Starting interval.');
                 startTextSwitchingDesktop(errand.id);
            }
            
            if (currentTextIndexes[cardId] !== errand.texts.length - 1) {
                console.log('Auto-switching to next text after TTS finished');
                currentCardSpeaking = null; 
                switchText(cardId);
            } else {
                currentCardSpeaking = null;
            }
        } else {
            currentCardSpeaking = null;
        }
    };
    
    newTts.onerror = function(event) {
        isTtsSpeaking = false;
        currentlySpeakingCards[cardId] = false;
        currentCardSpeaking = null;
        updateTTSButtonState();
        console.error('TTS error:', event.error);
    };

    // 4. Speak the new, isolated utterance
    try {
        window.speechSynthesis.speak(newTts);
    } catch (error) {
        console.error('TTS speak error on new utterance:', error);
        currentlySpeakingCards[cardId] = false;
    }
}


// Stop TTS function (MODIFIED)
function stopTTS() {
    window.speechSynthesis.cancel(); 
    isTtsSpeaking = false;
    
    Object.keys(currentlySpeakingCards).forEach(cardId => {
        currentlySpeakingCards[cardId] = false;
    });
    
    currentCardSpeaking = null;
    updateTTSButtonState();
    console.log('TTS stopped');
}


// Initialize TTS (MODIFIED: Stores voice, sets mobile default to OFF)
function initTTS() {
    if ('speechSynthesis' in window) {
        
        if (isMobileDevice()) {
            isTtsEnabled = false;
            console.log('Mobile device detected - TTS disabled by default');
        }
        
        speechSynthesis.onvoiceschanged = function() {
            const voices = speechSynthesis.getVoices();
            const preferredVoice = voices.find(voice => 
                voice.lang.includes('en') && (voice.name.includes('Natural') || voice.name.includes('Google US English'))
            ) || voices.find(voice => voice.lang.includes('en'));
            
            if (preferredVoice) {
                selectedVoice = preferredVoice; 
            }
            isTtsReady = true;
            console.log('TTS voices loaded, initialization complete');
            
            updateTTSButtonState();
            
            if (!isMobileDevice()) {
                console.log('Desktop device - initializing auto-play flow');
                initDesktopFlow();
            } else {
                console.log('Mobile device - waiting for user to enable audio');
            }
        };
        
        const voices = speechSynthesis.getVoices();
        if (voices.length > 0) {
            const preferredVoice = voices.find(voice => 
                voice.lang.includes('en') && (voice.name.includes('Natural') || voice.name.includes('Google US English'))
            ) || voices.find(voice => voice.lang.includes('en'));
            
            if (preferredVoice) {
                selectedVoice = preferredVoice;
            }
            isTtsReady = true;
            console.log('TTS voices available immediately');
            
            updateTTSButtonState();
            
            if (!isMobileDevice()) {
                console.log('Desktop device - initializing auto-play flow');
                initDesktopFlow();
            } else {
                console.log('Mobile device - waiting for user to enable audio');
            }
        } else {
            console.log('Waiting for voices to load...');
        }
        
    } else {
        console.warn('Speech Synthesis not supported');
        const ttsToggle = document.getElementById('tts-toggle');
        if (ttsToggle) ttsToggle.style.display = 'none';
    }
}


// Initialize desktop flow (UNTOUCHED)
function initDesktopFlow() {
    if (isMobileDevice()) return;
    
    window.addEventListener('scroll', handleDesktopInitialInteraction, { once: false });
    console.log('Desktop scroll listener added for welcome message');
}

// Handle desktop initial interaction (UNTOUCHED)
function handleDesktopInitialInteraction() {
    if (!hasUserInteracted && !hasPlayedWelcome && isTtsEnabled) {
        hasUserInteracted = true;
        console.log('Desktop initial interaction detected, playing welcome message...');
        playWelcomeMessage();
        
        window.removeEventListener('scroll', handleDesktopInitialInteraction);
    }
}

// Initialize Intersection Observer (DESKTOP ONLY) (UNTOUCHED)
function initIntersectionObserver() {
    if (isMobileDevice()) {
        console.log('Skipping intersection observer on mobile');
        return;
    }
    
    const rootMarginVertical = window.innerHeight * 0.25;
    
    const options = {
        root: null, 
        rootMargin: `-${rootMarginVertical}px 0px -${window.innerHeight - rootMarginVertical - 1}px 0px`, 
        threshold: 0 
    };
    
    intersectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const card = entry.target;
            const cardId = card.id;

            if (entry.isIntersecting) {
                const rect = card.getBoundingClientRect();
                const activationLine = window.innerHeight * 0.25;

                if (rect.top <= activationLine) {
                    
                    console.log(`Card ${cardId} crossed the top-line (IN)`);
                    
                    if (cardId === 'masterclass') {
                        isMasterclassActive = true;
                        if (!isTextSwitchingPaused[cardId] && textSwitchIntervals[cardId] === undefined) {
                            console.log('Masterclass card activated, interval start deferred until first TTS read completes.');
                        }
                    } 

                    if (isTtsEnabled && hasPlayedWelcome && !isWelcomeMessagePlaying && currentCardSpeaking !== cardId) {
                        
                        stopTTS(); 
                        
                        const isInitial = !hasCardBeenInitiallyRead[cardId] || !errandsData.find(e => e.id === cardId && e.hasTextSwitcher);
                        const errand = errandsData.find(e => e.id === cardId);
                        const isLastText = errand && errand.hasTextSwitcher && currentTextIndexes[cardId] === errand.texts.length - 1;
                        
                        const content = getCardContent(cardId, isInitial, isLastText);
                        
                        if (content) {
                            console.log(`Speaking content for card: ${cardId}. Initial Read: ${isInitial}`);
                            speakText(content, cardId);
                            if (errand && errand.hasTextSwitcher) {
                                hasCardBeenInitiallyRead[cardId] = true;
                            }
                        }
                    }
                }

            } else {
                console.log(`Card ${cardId} scrolled OUT of the target zone`);

                if (currentCardSpeaking === cardId) {
                    const rect = card.getBoundingClientRect();
                    if (rect.bottom < window.innerHeight * 0.25) { 
                        console.log(`Card ${cardId} scrolled out of view, stopping TTS`);
                        stopTTS();
                    }
                }

                if (errandsData.find(e => e.id === cardId && e.hasTextSwitcher)) {
                    if (cardId === 'masterclass') {
                        isMasterclassActive = false;
                    }
                    if (textSwitchIntervals[cardId] !== undefined) {
                        clearInterval(textSwitchIntervals[cardId]);
                        textSwitchIntervals[cardId] = undefined;
                        console.log(`Card ${cardId} deactivated, text switching stopped`);
                    }
                }
            }
        });
    }, options);
    
    document.querySelectorAll('.errand-card').forEach(card => {
        if (!card.id) {
            console.warn("Errand card without ID skipped by IntersectionObserver:", card);
            return;
        }
        intersectionObserver.observe(card);
    });
    
    console.log('Intersection Observer initialized for desktop with 25% top-line targeting');
}

// Update TTS button visual state (UNTOUCHED)
function updateTTSButtonState() {
    const ttsToggle = document.getElementById('tts-toggle');
    const ttsLabel = document.getElementById('tts-label');
    const ttsStatus = document.getElementById('tts-status');
    
    if (!ttsToggle) return;
    
    if (isTtsEnabled) {
        ttsToggle.classList.add('active');
        ttsLabel.textContent = 'Turn Off Audio';
        ttsStatus.textContent = isTtsSpeaking ? 'Speaking...' : 'Audio is on';
    } else {
        ttsToggle.classList.remove('active');
        ttsLabel.textContent = 'Turn On Audio';
        ttsStatus.textContent = 'Audio is off';
    }
}

// Enable TTS function (UNTOUCHED)
function enableTTS() {
    isTtsEnabled = true;
    updateTTSButtonState();
    console.log('TTS enabled');
    
    if (isMobileDevice() && !hasPlayedWelcome && isTtsReady) {
        console.log('Mobile: Playing welcome message on first TTS enable');
        playWelcomeMessage();
    }
    else if (!isMobileDevice() && !hasPlayedWelcome && hasUserInteracted && isTtsReady) {
        playWelcomeMessage();
    } 
    else if (hasPlayedWelcome && !isWelcomeMessagePlaying) {
        if (!isMobileDevice()) {
            setTimeout(() => {
                const visibleCard = findFirstVisibleCard();
                if (visibleCard && !currentCardSpeaking) {
                    const isInitial = !hasCardBeenInitiallyRead[visibleCard.id] || !errandsData.find(e => e.id === visibleCard.id && e.hasTextSwitcher);
                    const errand = errandsData.find(e => e.id === visibleCard.id);
                    const isLastText = errand && errand.hasTextSwitcher && currentTextIndexes[visibleCard.id] === errand.texts.length - 1;
                    
                    const content = getCardContent(visibleCard.id, isInitial, isLastText);
                    
                    if (content) {
                        console.log('Speaking content for initially visible card:', visibleCard.id);
                        speakText(content, visibleCard.id);
                        if (errand && errand.hasTextSwitcher) {
                            hasCardBeenInitiallyRead[visibleCard.id] = true; 
                        }
                    }
                }
            }, 50);
        }
    }
}

// Disable TTS function (UNTOUCHED)
function disableTTS() {
    isTtsEnabled = false;
    stopTTS(); 
    errandsData.forEach(errand => {
        hasCardBeenInitiallyRead[errand.id] = false;
    });
    updateTTSButtonState();
    console.log('TTS disabled');
}

// Toggle TTS on/off (UNTOUCHED)
function toggleTTS() {
    if (isTtsEnabled) {
        disableTTS();
    } else {
        enableTTS();
    }
}

// Add this helper function to find the first visible card (desktop only) (UNTOUCHED)
function findFirstVisibleCard() {
    const cards = document.querySelectorAll('.errand-card');
    for (let card of cards) {
        const rect = card.getBoundingClientRect();
        if (rect.top >= 0 && rect.top <= window.innerHeight * 0.8) {
            return card;
        }
    }
    return null;
}

// Get card content for TTS (UNTOUCHED)
function getCardContent(cardId, isInitialRead = false, isLastText = false) {
    const card = document.getElementById(cardId);
    if (!card) return '';
    
    const title = card.querySelector('.errand-title')?.textContent || '';
    const tasks = card.querySelector('.completed-tasks')?.textContent || '';
    
    const errand = errandsData.find(e => e.id === cardId);
    
    if (errand && errand.hasTextSwitcher) {
        const currentTextIndex = currentTextIndexes[cardId] || 0;
        const currentText = errand.texts[currentTextIndex]; 
        
        console.log(`TTS Content Logic: Card ${cardId}, Initial: ${isInitialRead}, Last Text: ${isLastText}`);
        
        if (isInitialRead) {
            return `${title}. ${currentText}. ${tasks}`;
        } else if (isLastText) {
            return `${currentText}. ${tasks}`;
        } else {
            return `${currentText}.`;
        }
    } else {
        const description = card.querySelector('.errand-description')?.textContent || '';
        return `${title}. ${description}. ${tasks}`;
    }
}

// Initialize everything when page loads (UNTOUCHED)
document.addEventListener('DOMContentLoaded', function() {
    renderErrandCards();
    initTextSwitching();
    
    const ttsToggle = document.getElementById('tts-toggle');
    
    if (ttsToggle) {
        ttsToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleTTS();
        });
    }
    
    errandsData.forEach(errand => {
        if (errand.hasTextSwitcher) {
            const pauseBtn = document.getElementById(`${errand.id}-pause-btn`);
            const playBtn = document.getElementById(`${errand.id}-play-btn`);
            
            if (pauseBtn) {
                pauseBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    pauseTextSwitching(errand.id);
                });
            }
            if (playBtn) {
                playBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    playTextSwitching(errand.id);
                });
            }
        }
    });
    
    renderTestimonials("residents-testimonials", residentTestimonials);
    renderTestimonials("team-testimonials", teamMemberTestimonials);
    renderTestimonials("volunteer-testimonials", volunteerTestimonials);
    
    initTTS();
    
    console.log('Initialization complete: TTS system ready');
});
</script>
</body>
</html>
